package me.jorgeluquetta.proyecto_moviles

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.google.android.gms.maps.model.LatLng
import com.google.android.gms.maps.model.LatLngBounds
import kotlinx.coroutines.delay
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.launch


data class BusInfo(
    val nombreRuta: String,
    val conductor: String,
    val placa: String,
    val pasajeros: Int
)

class BusViewModel : ViewModel() {

    // Información de los buses
    private val busInfoMap = mapOf(
        "hamacas" to BusInfo(
            nombreRuta = "Hamacas",
            conductor = "Juan Gómez",
            placa = "ABC-123",
            pasajeros = 30
        ),
        "caracoli" to BusInfo(
            nombreRuta = "Caracolí",
            conductor = "María Rojas",
            placa = "DEF-456",
            pasajeros = 25
        ),
        "cumbre" to BusInfo(
            nombreRuta = "Cumbre",
            conductor = "Carlos Díaz",
            placa = "GHI-789",
            pasajeros = 20
        ),
    )

    // Posiciones actuales de los buses
    private val _busPositions = MutableStateFlow<Map<String, LatLng>>(emptyMap())
    val busPositions: StateFlow<Map<String, LatLng>> = _busPositions

    // Rutas predefinidas
    private val routes = mapOf(
        "hamacas" to listOf(
            LatLng(7.156542781409377, -73.13735090196793),
            LatLng(7.156361812079029, -73.13802681863876),
            LatLng(7.156127616368512, -73.13799463213063),
            LatLng(7.155755032009696, -73.13776932656906),
            LatLng(7.155031153008251, -73.13726507127494),
            LatLng(7.154275336943341, -73.13721142709471),
            LatLng(7.153679199445949, -73.13696466386568),
            LatLng(7.151922718312326, -73.13558064401259),
            LatLng(7.151017861785376, -73.13532315194752),
            LatLng(7.150373150376523, -73.13576973975334),
            LatLng(7.150018216136713, -73.13547995122354),
            LatLng(7.149709499294563, -73.1348254922248),
            LatLng(7.149571108918282, -73.1343426946028),
            LatLng(7.148911092700733, -73.13432123693069),
            LatLng(7.14817934544773, -73.13450592010041),
            LatLng(7.147700300054345, -73.1339802071342),
            LatLng(7.14789191827197, -73.13413041083882),
            LatLng(7.146954590952802, -73.13398040201356),
            LatLng(7.146818020818449, -73.13416252717447),
            LatLng(7.1467035004271295, -73.13395832769041),
            LatLng(7.145738885222862, -73.13287074348177),
            LatLng(7.144969965668173, -73.13291418028145),
            LatLng(7.14625046010668, -73.13617466535781),
            LatLng(7.145602739962384, -73.13852983172909),
            LatLng(7.145234428098383, -73.1376210447054),
            LatLng(7.145153082074426, -73.13671211057941),
            LatLng(7.142087162535195, -73.13356856161451),
            LatLng(7.141150349647937, -73.13336471372811),
            LatLng(7.134763489025656, -73.13093855200692),
            LatLng(7.134781646917266, -73.13083136869176),
            LatLng(7.134677181140537, -73.13023626599504),
            LatLng(7.1314753452089015, -73.1254647870031),
            LatLng(7.130800872762204, -73.12536189541099),
            LatLng(7.130903112559471, -73.12458911968162),
            LatLng(7.127548067429095, -73.1195023720302),
            LatLng(7.127092172940554, -73.11940531167937),
            LatLng(7.1268448001646885, -73.11902206105283),
            LatLng(7.1192100965272855, -73.11580134817399),
            LatLng(7.118918984514035, -73.11640198253293),
            LatLng(7.11928944611955, -73.1166387551875),
            LatLng(7.120258241963488, -73.11532983719003),
            LatLng(7.1203668893891665, -73.11531248863096),
            LatLng(7.121357478277055, -73.11484493563005),
            LatLng(7.121965623572591, -73.11415624269556),
            LatLng(7.123297646026504, -73.11347837189184),
            LatLng(7.123330574184164, -73.11328547438961),
            LatLng(7.123197498745843, -73.11318255233942),
            LatLng(7.122993207933615, -73.11316619971781),
            LatLng(7.123347292050941, -73.1123629585445),
            LatLng(7.117530103014903, -73.11125706852256)
        ),
        "caracoli" to listOf(
            LatLng(7.0715176814219065, -73.10564515407367),
            LatLng(7.072157540373758, -73.10640519639948),
            LatLng(7.072832624976801, -73.10706039477455),
            LatLng(7.074323311363237, -73.10787724024712),
            LatLng(7.074669778871577, -73.10801074830958),
            LatLng(7.074969869164385, -73.1081049721134),
            LatLng(7.076604278932571, -73.10812909802569),
            LatLng(7.079048398497759, -73.10798755941742),
            LatLng(7.081943557401422, -73.10792214017782),
            LatLng(7.084480790297952, -73.10777495405881),
            LatLng(7.085625496503155, -73.10775571413602),
            LatLng(7.086214790075669, -73.10770969785987),
            LatLng(7.08745223363111, -73.10794647799018),
            LatLng(7.088904478171954, -73.10837270679728),
            LatLng(7.089907231482187, -73.10871467052142),
            LatLng(7.090979870816644, -73.1091104390988),
            LatLng(7.092934975554442, -73.10980238629348),
            LatLng(7.09429135154508, -73.11002821001912),
            LatLng(7.094935133977878, -73.11025285321014),
            LatLng(7.0953510091144825, -73.11035943632608),
            LatLng(7.096577122397953, -73.11065145940142),
            LatLng(7.09773894919538, -73.1109167994097),
            LatLng(7.099457055864337, -73.111326653214),
            LatLng(7.100236971089914, -73.11150561828194),
            LatLng(7.100783951226664, -73.1115456328543),
            LatLng(7.101207109620952, -73.11153163712693),
            LatLng(7.101738574934678, -73.11134022264667),
            LatLng(7.103014640542938, -73.1107818003648),
            LatLng(7.103314780702975, -73.11069301860311),
            LatLng(7.103698508474178, -73.11067175032753),
            LatLng(7.104093446461577, -73.11077657044977),
            LatLng(7.104402346819354, -73.1110027875628),
            LatLng(7.105006174372195, -73.1118453132898),
            LatLng(7.105432966492701, -73.11259387553794),
            LatLng(7.1055980711576225, -73.1127524985436),
            LatLng(7.105833970579722, -73.11290464270706),
            LatLng(7.106469053540526, -73.11302071856352),
            LatLng(7.106633508842298, -73.11312939296366),
            LatLng(7.106796703935214, -73.11328625021663),
            LatLng(7.106974862310265, -73.11368329547456),
            LatLng(7.107084117615271, -73.11379302130054),
            LatLng(7.107398199803534, -73.11399950266524),
            LatLng(7.109534880105196, -73.11429527423033),
            LatLng(7.111468683706557, -73.1145613208253),
            LatLng(7.115285063764878, -73.11501561343263),
            LatLng(7.118796434882522, -73.11553103589812),
            LatLng(7.119286741919165, -73.1148095931336),
            LatLng(7.119824629909102, -73.11402452983378),
            LatLng(7.120552632493561, -73.1128235699199),
            LatLng(7.121071736853124, -73.11188677772144),
            LatLng(7.117585855405062, -73.11126704003105)
        ),
        "cumbre" to listOf(
            LatLng(7.0771789754590895, -73.08927174767031),
            LatLng(7.07854013778212, -73.08804149625405),
            LatLng(7.0783531903730355, -73.08781356298478),
            LatLng(7.079806094638653, -73.08672857644231),
            LatLng(7.079338524864798, -73.08611336496978),
            LatLng(7.0793444811706285, -73.08611636600135),
            LatLng(7.0801824728787635, -73.08571501424645),
            LatLng(7.080192281636502, -73.08546846072865),
            LatLng(7.080213850778728, -73.08519134100236),
            LatLng(7.08057525600052, -73.08496770447566),
            LatLng(7.080807422804036, -73.08494256924087),
            LatLng(7.081949037251192, -73.08495762346905),
            LatLng(7.082211929554045, -73.0847547690158),
            LatLng(7.082961185411055, -73.08493282367036),
            LatLng(7.0831440210043395, -73.0849144376571),
            LatLng(7.083332415207838, -73.08464708398832),
            LatLng(7.083703794683727, -73.08449013655243),
            LatLng(7.0838014421953375, -73.08446453691748),
            LatLng(7.08463359231955, -73.08677234457522),
            LatLng(7.085091999647924, -73.08771530159028),
            LatLng(7.08565014539162, -73.08840784985814),
            LatLng(7.086536346384817, -73.08921248406186),
            LatLng(7.086697356613801, -73.08960951857958),
            LatLng(7.086653789147206, -73.09048757572495),
            LatLng(7.08634878608118, -73.09186431721513),
            LatLng(7.086414495749137, -73.09217920952901),
            LatLng(7.086836838451578, -73.0927872008592),
            LatLng(7.086976560767673, -73.09331999325735),
            LatLng(7.085969975559814, -73.0974064421117),
            LatLng(7.085969975559814, -73.09801940767197),
            LatLng(7.0864111953161695, -73.09831294047548),
            LatLng(7.088263392876483, -73.09829970357114),
            LatLng(7.090068028097878, -73.098901861818),
            LatLng(7.091546509428474, -73.09856196569937),
            LatLng(7.092105877504484, -73.09867094392493),
            LatLng(7.092937470143374, -73.0992496558925),
            LatLng(7.093631084378625, -73.09932857115865),
            LatLng(7.093907038131779, -73.09961041139714),
            LatLng(7.09448902997447, -73.10093591793913),
            LatLng(7.094653869235855, -73.1011714485548),
            LatLng(7.095038063842971, -73.10141065163764),
            LatLng(7.097022601045166, -73.10270715625938),
            LatLng(7.097477751570697, -73.10308648450749),
            LatLng(7.097866506601015, -73.1038525310324),
            LatLng(7.098051026797719, -73.10442276303039),
            LatLng(7.097944253051461, -73.10596876748806),
            LatLng(7.098106630801034, -73.1063257823042),
            LatLng(7.098296071443486, -73.1064522250578),
            LatLng(7.1002224969936565, -73.10680691396107),
            LatLng(7.101009778618638, -73.10686393716088),
            LatLng(7.10145448134829, -73.10690577510321),
            LatLng(7.102563862487678, -73.10767259348845),
            LatLng(7.105076692898365, -73.10944258235288),
            LatLng(7.105579210048669, -73.10952334310475),
            LatLng(7.105940695505765, -73.10867489138906),
            LatLng(7.106194852723114, -73.10834965386441),
            LatLng(7.107299563525803, -73.10818195609893),
            LatLng(7.107773683522716, -73.10833060233495),
            LatLng(7.108837817707362, -73.10818195609042),
            LatLng(7.109206576497246, -73.10804392744002),
            LatLng(7.109658317116504, -73.10768191055374),
            LatLng(7.109974395532828, -73.10763236180745),
            LatLng(7.110067791933028, -73.10763977679578),
            LatLng(7.110137381995174, -73.10759505663503),
            LatLng(7.11028664758886, -73.10756253288211),
            LatLng(7.110342751940548, -73.10760777368326),
            LatLng(7.113502604140836, -73.10812842856694),
            LatLng(7.116978283910127, -73.10875919829171),
            LatLng(7.119275078730304, -73.10920513698996),
            LatLng(7.118831716323697, -73.1114981474269),
            LatLng(7.117582207754439, -73.11126132280515)
        ),
        "cristal bajo" to listOf(
            LatLng(7.071710276279326, -73.12150331077103),
            LatLng(7.07181356363636, -73.12122021557438),
            LatLng(7.0716689613300545, -73.1211556865222),
            LatLng(7.0718073663986525, -73.12092254930042),
            LatLng(7.0732038092355625, -73.1192739360946),
            LatLng(7.073426709783997, -73.11981834708338),
            LatLng(7.0735145916941535, -73.1199743741545),
            LatLng(7.073924707053641, -73.11972557423027),
            LatLng(7.074468737093497, -73.11964966916808),
            LatLng(7.0751341267957395, -73.11919002184992),
            LatLng(7.0757283733788086, -73.11890326939488),
            LatLng(7.075711634048911, -73.11878519485457),
            LatLng(7.075180160009079, -73.11873459148015),
            LatLng(7.075117387444291, -73.118515310191),
            LatLng(7.075456359192764, -73.11833819838054),
            LatLng(7.075753482383488, -73.11837615091125),
            LatLng(7.076213813692721, -73.11803879508179),
            LatLng(7.076485827453882, -73.11820325604756),
            LatLng(7.0767996892619935, -73.11808939845513),
            LatLng(7.0771009963969576, -73.11768878840765),
            LatLng(7.077100996407746, -73.11768035451097),
            LatLng(7.077922229551274, -73.11772723100447),
            LatLng(7.078068115940046, -73.1174184860697),
            LatLng(7.078031329669778, -73.11690790668652),
            LatLng(7.078551233059431, -73.11691744626307),
            LatLng(7.078982797418466, -73.11669161880909),
            LatLng(7.079015614990161, -73.11602825423019),
            LatLng(7.079127094098225, -73.11606150865606),
            LatLng(7.079112543343996, -73.1155430357604),
            LatLng(7.085328355595114, -73.1154203931814),
            LatLng(7.085422638618938, -73.11187261592984),
            LatLng(7.08581419607601, -73.11100194984924),
            LatLng(7.087350379080653, -73.10940447711768),
            LatLng(7.0879859704731984, -73.10896005849378),
            LatLng(7.088227235547749, -73.10861236627625),
            LatLng(7.088442558043549, -73.10793005297572),
            LatLng(7.092935151896568, -73.10586853586325),
            LatLng(7.095506132217217, -73.1070896720454),
            LatLng(7.096433672443833, -73.10838619059871),
            LatLng(7.098346702185779, -73.10908756312384),
            LatLng(7.099558480750826, -73.10866544080434),
            LatLng(7.101376142560068, -73.10794180254268),
            LatLng(7.102961915747423, -73.10776843087534),
            LatLng(7.103150014897556, -73.10797730338969),
            LatLng(7.103564089366475, -73.10794179043593),
            LatLng(7.103520038908772, -73.1073691440567),
            LatLng(7.104057454204254, -73.10625936425197),
            LatLng(7.104590463847551, -73.10637922047056),
            LatLng(7.104634514226146, -73.10725372695669),
            LatLng(7.1049604867228755, -73.10770651711701),
            LatLng(7.105286458988456, -73.1077731039053),
            LatLng(7.105440634979486, -73.10805276841609),
            LatLng(7.105528735522562, -73.10836794588063),
            LatLng(7.106767480904466, -73.10821340271531),
            LatLng(7.107342663472742, -73.10817955461707),
            LatLng(7.108087109450134, -73.10833048467033),
            LatLng(7.109208640417522, -73.10802464956856),
            LatLng(7.1100781463331915, -73.10762317876046),
            LatLng(7.1102737536716045, -73.10756533723496),
            LatLng(7.1192969175979695, -73.10920022174774),
            LatLng(7.118832061149194, -73.11149917988162),
            LatLng(7.117587313214591, -73.1112627850345)
        ),
        "inem" to listOf(
            LatLng(7.085661082256215, -73.11816893557649),
            LatLng(7.085349215196023, -73.11822131342007),
            LatLng(7.085095440863884, -73.11819050292385),
            LatLng(7.085034290401511, -73.1181134766833),
            LatLng(7.085171878930441, -73.11792245160676),
            LatLng(7.085263604593561, -73.11788239796168),
            LatLng(7.085346157674776, -73.11774683177833),
            LatLng(7.085367560323044, -73.11724770173963),
            LatLng(7.085303817456819, -73.11249902211048),
            LatLng(7.085459751028652, -73.1117318407547),
            LatLng(7.085786905605958, -73.11101395619286),
            LatLng(7.087341588766763, -73.10941005013439),
            LatLng(7.088127523608893, -73.10881676345575),
            LatLng(7.088140832162748, -73.10881676345575),
            LatLng(7.088474840500124, -73.1079094345069),
            LatLng(7.089390467228607, -73.10740517922397),
            LatLng(7.090052515090469, -73.1087064418295),
            LatLng(7.093182693690099, -73.10984897267983),
            LatLng(7.097650074917812, -73.11088241784529),
            LatLng(7.101134398349675, -73.11162654471002),
            LatLng(7.103171381939705, -73.11073466735037),
            LatLng(7.104267134948358, -73.11090454874115),
            LatLng(7.105390981422022, -73.11251842205861),
            LatLng(7.105899429311406, -73.11292221915737),
            LatLng(7.106465045067755, -73.11303005588077),
            LatLng(7.106474217209409, -73.11302697483153),
            LatLng(7.10680747157775, -73.11328886402053),
            LatLng(7.106963767522847, -73.11368583676659),
            LatLng(7.107404029638449, -73.11400934693675),
            LatLng(7.113323144412665, -73.11477477960275),
            LatLng(7.115234801225246, -73.1150351587583),
            LatLng(7.118855534758684, -73.11555326549049),
            LatLng(7.121409658631453, -73.11655945501296),
            LatLng(7.124340291074022, -73.11771013667199),
            LatLng(7.125412700965947, -73.11819768631912),
            LatLng(7.126836681827871, -73.11882036566377),
            LatLng(7.127012848077482, -73.11879334901884),
            LatLng(7.1273230537075865, -73.11869300147916),
            LatLng(7.127606451253422, -73.11871615860339),
            LatLng(7.1280575193975855, -73.11855344498379),
            LatLng(7.128494104036441, -73.11666227981792),
            LatLng(7.128980474149358, -73.11578616861797),
            LatLng(7.1308680263983355, -73.11317183450689),
            LatLng(7.131059227019893, -73.11005004839681),
            LatLng(7.1311253402523525, -73.10990408756027),
            LatLng(7.131136949629168, -73.10946680455953),
            LatLng(7.130901689938519, -73.10891450565316),
            LatLng(7.130273476807423, -73.10839802140958),
            LatLng(7.130083359502764, -73.10818698483321),
            LatLng(7.12993732731678, -73.10708737321445),
            LatLng(7.130163263881129, -73.10675971117037),
            LatLng(7.130482881277085, -73.10679303272111),
            LatLng(7.131249620742042, -73.10753949211357),
            LatLng(7.131167330015739, -73.10755225092146),
            LatLng(7.132408019396887, -73.10800518860108),
            LatLng(7.133940650448275, -73.1077906993895),
            LatLng(7.1340636354135025, -73.10760379946045),
            LatLng(7.133900031585112, -73.10679771821138),
            LatLng(7.133929116714503, -73.1064331496281),
            LatLng(7.134076360153353, -73.106002628961),
            LatLng(7.13403838310911, -73.10571490305435),
            LatLng(7.1340091668347885, -73.10575233968613),
            LatLng(7.1335982863866905, -73.10497725572621),
            LatLng(7.1336650105871025, -73.10441452353611),
            LatLng(7.133430266335313, -73.103670795978),
            LatLng(7.134472609558394, -73.10203137319755),
            LatLng(7.134426751649645, -73.10160310736049),
            LatLng(7.13355798309651, -73.10073778264007),
            LatLng(7.133031741414435, -73.09921033776855),
            LatLng(7.1328574807879255, -73.0992195809159),
            LatLng( 7.132768821847218, -73.09972487297034),
            LatLng(7.132808565512416, -73.10000832948869),
            LatLng(7.132661819654554, -73.10044891951175),
            LatLng(7.13279633668646, -73.10105588619265),
            LatLng(7.133294660824405, -73.10167517706424),
            LatLng(7.1332274023815785, -73.10198944408508),
            LatLng(7.1325334169821994, -73.10239922361703),
            LatLng(7.132197124107037, -73.10245468250513),
            LatLng(7.131794537487975, -73.10240583894465),
            LatLng(7.131477051702526, -73.10215773318251),
            LatLng(7.130780489113339, -73.10051682511316),
            LatLng(7.130693418712346, -73.10020092836659),
            LatLng(7.130498961431655, -73.09991720629758),
            LatLng(7.130356746347815, -73.09926493800305),
            LatLng(7.130205824175453, -73.09889054187073),
            LatLng(7.129947624100191, -73.0966620008381),
            LatLng(7.12991860058219, -73.09609748165725),
            LatLng(7.129738654735192, -73.09532528961789),
            LatLng(7.129880870005555, -73.09489531905967),
            LatLng(7.129616755889745, -73.09428692531729),
            LatLng(7.129268473307243, -73.09402075305411),
            LatLng(7.129085624849951, -73.09383355498794),
            LatLng(7.127977673956146, -73.09376380945848),
            LatLng(7.12704020939402, -73.09437512814304)
        ),
        "trinidad" to listOf(
            LatLng(7.12749871628681, -73.10843583677672),
            LatLng(7.126694743099651, -73.10796714196285),
            LatLng(7.126010740396363, -73.10951477666885),
            LatLng(7.124943009037666, -73.10891454097623),
            LatLng(7.124956316523771, -73.108817981446),
            LatLng(7.124958978020947, -73.1088287102827),
            LatLng(7.124402724775441, -73.10800795427565),
            LatLng(7.124527815278644, -73.10780209021878),
            LatLng(7.124535799777912, -73.10779136138164),
            LatLng(7.124470593029781, -73.1076398165571),
            LatLng(7.124370786761374, -73.10755398585603),
            LatLng(7.123067878685396, -73.10725032739936),
            LatLng(7.122380990958233, -73.10679786642524),
            LatLng(7.120936015540877, -73.10642772304051),
            LatLng(7.1200922043335115, -73.10620588749596),
            LatLng(7.118527467277837, -73.10619692086865),
            LatLng(7.118534192081961, -73.10623243480084),
            LatLng(7.118374500000012, -73.10549214513017),
            LatLng(7.118143938712891, -73.1055069546658),
            LatLng(7.117803282472661, -73.10571222804332),
            LatLng(7.1175714955950005, -73.10564498331121),
            LatLng(7.117459114042675, -73.10540431797205),
            LatLng(7.119010547537813, -73.10491650730742),
            LatLng(7.118578749841647, -73.10451819544096),
            LatLng(7.117948525403835, -73.10468631534229),
            LatLng(7.117735361045961, -73.10463494536286),
            LatLng(7.117239521862716, -73.1043220555465),
            LatLng(7.116604661545753, -73.10442479548423),
            LatLng(7.116299584931713, -73.1043274034694),
            LatLng(7.1160244264814105, -73.10443215914694),
            LatLng(7.115458822488, -73.10512231417988),
            LatLng(7.114455760721759, -73.10531385300844),
            LatLng(7.113981696208809, -73.10582461113877),
            LatLng(7.112994945521603, -73.10618952467368),
            LatLng(7.112922330267671, -73.10628709592436),
            LatLng(7.112817441547269, -73.1062606703773),
            LatLng(7.112769031358282, -73.1061712300625),
            LatLng(7.112819458636002, -73.10606959334304),
            LatLng(7.112633067787309, -73.10598056855049),
            LatLng(7.11090725930537, -73.10609996063971),
            LatLng(7.105841130976395, -73.10663444339201),
            LatLng(7.105744946100499, -73.10716382668775),
            LatLng(7.104728939372077, -73.10747992335641),
            LatLng(7.104593935685954, -73.10698469438421),
            LatLng(7.104583289225276, -73.10645898140795),
            LatLng(7.104136137654301, -73.10628195560983),
            LatLng(7.1039391778957715, -73.1063409642092),
            LatLng(7.103529288398056, -73.10730655947171),
            LatLng(7.103609137030165, -73.1078590945386),
            LatLng(7.103497348933694, -73.10805221358966),
            LatLng(7.103130045021847, -73.10798784057216),
            LatLng(7.10253916417511, -73.1079878405616),
            LatLng(7.10180455451504, -73.1078912810316),
            LatLng(7.10122964179183, -73.10804684915807),
            LatLng(7.100072268987482, -73.10864443487166),
            LatLng(7.099489267204894, -73.10867982683183),
            LatLng(7.099925979312684, -73.10864951292834),
            LatLng(7.098578522789164, -73.1089991432243),
            LatLng(7.097497327270584, -73.10884465541203),
            LatLng(7.096787287052918, -73.10857633448376),
            LatLng(7.096884772696471, -73.1085362736927),
            LatLng(7.097049016349948, -73.10856046386779),
            LatLng(7.097056596824843, -73.108574468706),
            LatLng(7.097529755600817, -73.10843771899951),
            LatLng(7.097824130313483, -73.10797046666433),
            LatLng(7.097955671995897, -73.10810357653642),
            LatLng(7.098191225244669, -73.10819134629025),
            LatLng(7.098431272959981, -73.10820280479425),
            LatLng(7.098432786897114, -73.10820640655824),
            LatLng(7.0990379519204625, -73.10802732877629),
        ),
        "la feria" to listOf(
            LatLng(7.120107700890012, -73.1412282692482),
            LatLng(7.120757402538474, -73.14096105996053),
            LatLng(7.121699300000023, -73.14007973046255),
            LatLng(7.120792000000004, -73.13897481175744),
            LatLng(7.121036859879143, -73.13793411468417),
            LatLng(7.120979116137413, -73.13613444785013),
            LatLng(7.121497623595485, -73.13255337228031),
            LatLng(7.120760792920417, -73.13214362733234),
            LatLng(7.120603492178339, -73.13180431098012),
            LatLng(7.120458420544779, -73.13150990929961),
            LatLng(7.120681906188945, -73.13127591171691),
            LatLng(7.119635399977457, -73.13061830779569),
            LatLng(7.119004461107704, -73.13038570444336),
            LatLng(7.119698659244082, -73.12848943508769),
            LatLng(7.120450928774752, -73.1265431614917),
            LatLng(7.1196502675946, -73.1262283883133),
            LatLng(7.119368716078245, -73.12700423769668)
        ),
        "maria paz" to listOf(
            LatLng(7.14864526474993, -73.14017049154407),
            LatLng(7.148812077764993, -73.13996501166466),
            LatLng(7.1490669308648185, -73.1398342517414),
            LatLng(7.149159604684062, -73.13996968166192),
            LatLng(7.149173505755317, -73.13996501166466),
            LatLng(7.149475498111412, -73.13986064328445),
            LatLng(7.149411625597269, -73.13938052784242),
            LatLng(7.149455707769249, -73.13935865235938),
            LatLng(7.148526890689071, -73.13784795300708),
            LatLng(7.148496695778455, -73.13689264708013),
            LatLng(7.148795188992663, -73.13664313374026),
            LatLng(7.148489672404811, -73.13591759848272),
            LatLng(7.146903874259631, -73.1340990572683),
            LatLng(7.146781718785799, -73.1341514274996),
            LatLng(7.146690039168611, -73.13406406988925),
            LatLng(7.14670170748454, -73.13394647310609),
            LatLng(7.145722154491951, -73.13284920101317),
            LatLng(7.144967733745514, -73.13295726759291),
            LatLng(7.14522431353213, -73.13443546405281),
            LatLng(7.146246801690209, -73.13621084357693),
            LatLng(7.145789854877735, -73.13838756948012),
            LatLng(7.145502129369546, -73.13859469642813),
            LatLng(7.1452613793201545, -73.13829880080183),
            LatLng(7.145302482996106, -73.13713297203425),
            LatLng(7.14510283653547, -73.13665362111966),
            LatLng(7.142254928935288, -73.13374792599569),
            LatLng(7.141937841215355, -73.13349345575065),
            LatLng(7.134865732346368, -73.13102992834814),
            LatLng(7.13469746258421, -73.13028715869666),
            LatLng(7.131487174789116, -73.12546515951777),
            LatLng(7.130940116172627, -73.12547377394591),
            LatLng(7.13069223000871, -73.12487937839602),
            LatLng(7.1308888293806385, -73.12453480127023),
            LatLng(7.127464315850097, -73.11952390743497),
            LatLng(7.126600981097503, -73.119993393768),
            LatLng(7.1260239990163745, -73.1207040841193)
        ),
        "caldas" to listOf(
            LatLng(7.090812698856763, -73.10384312063425),
            LatLng(7.092202101655015, -73.10446002879766),
            LatLng(7.091829465302793, -73.10564020093143),
            LatLng(7.09162717687104, -73.10554900581201),
            LatLng(7.091281156979158, -73.10641804165599),
            LatLng(7.089391351418355, -73.10744801009666),
            LatLng(7.090042264414413, -73.10869667075902),
            LatLng(7.093028742458919, -73.10995160079334),
            LatLng(7.100782168287694, -73.1115068311888),
            LatLng(7.102271658613998, -73.11109952328252),
            LatLng(7.1034392959025245, -73.11068467264248),
            LatLng(7.103963234747772, -73.11074501455718),
            LatLng(7.105371271258066, -73.112638521539),
            LatLng(7.1070701625316826, -73.1149264100865),
            LatLng(7.112772490639449, -73.1219983656938),
            LatLng(7.113304803958871, -73.12361305575905),
            LatLng(7.115608186016079, -73.12461141820039),
            LatLng(7.115336707678208, -73.12669281273185),
            LatLng(7.117617693846891, -73.12723129719656),
            LatLng(7.117699536180822, -73.12728963524127),
            LatLng(7.1199075550048105, -73.12803935970648),
            LatLng(7.12003267260564, -73.12761906002262),

        ),
        "cra 33" to listOf (
            LatLng(7.117582207754439, -73.11126132280515),
            LatLng(7.118831716323697, -73.1114981474269),
            LatLng(7.119275078730304, -73.10920513698996),
            LatLng(7.116978283910127, -73.10875919829171),
            LatLng(7.113502604140836, -73.10812842856694),
            LatLng(7.110342751940548, -73.10760777368326),
            LatLng(7.11028664758886, -73.10756253288211),
            LatLng(7.110137381995174, -73.10759505663503),
            LatLng(7.110067791933028, -73.10763977679578),
            LatLng(7.109974395532828, -73.10763236180745),
            LatLng(7.109206576497246, -73.10804392744002),
            LatLng(7.108837817707362, -73.10818195609042),
            LatLng(7.107773683522716, -73.10833060233495),
            LatLng(7.107299563525803, -73.10818195609893),
            LatLng(7.106194852723114, -73.10834965386441),
            LatLng(7.105940695505765, -73.10867489138906),
            LatLng(7.105579210048669, -73.10952334310475),
            LatLng(7.105579210048669, -73.10952334310475),
            LatLng(7.105076692898365, -73.10944258235288),
            LatLng(7.102563862487678, -73.10767259348845),
            LatLng(7.10145448134829, -73.10690577510321),
            LatLng(7.101009778618638, -73.10686393716088),
            LatLng(7.1002224969936565, -73.10680691396107),
            LatLng(7.098296071443486, -73.1064522250578),
            LatLng(7.098106630801034, -73.1063257823042),
            LatLng(7.097944253051461, -73.10596876748806),
            LatLng(7.098051026797719, -73.10442276303039),
            LatLng(7.097866506601015, -73.1038525310324),
            LatLng(7.097477751570697, -73.10308648450749),
            LatLng(7.097022601045166, -73.10270715625938),
            LatLng(7.095038063842971, -73.10141065163764),
            LatLng(7.094653869235855, -73.1011714485548),
            LatLng(7.09448902997447, -73.10093591793913),
            LatLng(7.093907038131779, -73.09961041139714),
            LatLng(7.093631084378625, -73.09932857115865),
            LatLng(7.092937470143374, -73.0992496558925),
            LatLng(7.092105877504484, -73.09867094392493),
            LatLng(7.091546509428474, -73.09856196569937),
            LatLng(7.090068028097878, -73.098901861818),
            LatLng(7.088263392876483, -73.09829970357114),
            LatLng(7.0864111953161695, -73.09831294047548),
            LatLng(7.085969975559814, -73.09801940767197),
            LatLng(7.085969975559814, -73.0974064421117),
            LatLng(7.086976560767673, -73.09331999325735),
            LatLng(7.086836838451578, -73.0927872008592),
            LatLng(7.086414495749137, -73.09217920952901),
            LatLng(7.08634878608118, -73.09186431721513),
            LatLng(7.086653789147206, -73.09048757572495),
            LatLng(7.086697356613801, -73.08960951857958),
            LatLng(7.086536346384817, -73.08921248406186),
            LatLng(7.08565014539162, -73.08840784985814),
            LatLng(7.085091999647924, -73.08771530159028),
            LatLng(7.08463359231955, -73.08677234457522),
            LatLng(7.0838014421953375, -73.08446453691748),
            LatLng(7.083703794683727, -73.08449013655243),
            LatLng(7.083332415207838, -73.08464708398832),
            LatLng(7.0831440210043395, -73.0849144376571),
            LatLng(7.082961185411055, -73.08493282367036),
            LatLng(7.082211929554045, -73.0847547690158),
            LatLng(7.081949037251192, -73.08495762346905),
            LatLng(7.080807422804036, -73.08494256924087),
            LatLng(7.08057525600052, -73.08496770447566),
            LatLng(7.080213850778728, -73.08519134100236),
            LatLng(7.080192281636502, -73.08546846072865),
            LatLng(7.0801824728787635, -73.08571501424645),
            LatLng(7.0793444811706285, -73.08611636600135),
            LatLng(7.079338524864798, -73.08611336496978),
            LatLng(7.079806094638653, -73.08672857644231),
            LatLng(7.0783531903730355, -73.08781356298478),
            LatLng(7.07854013778212, -73.08804149625405),
            LatLng(7.0771789754590895, -73.08927174767031)

        )
    )

    init {
        // Simulación del movimiento de los buses
        routes.forEach { (name, points) ->
            if (points.size >= 2) startRouteSimulation(name, points)
        }
    }

    private fun startRouteSimulation(routeName: String, points: List<LatLng>) {
        viewModelScope.launch {
            var idx = 0
            while (true) {
                val start = points[idx]
                val end = points[(idx + 1) % points.size]

                // 10 pasos intermedios por tramo (movimiento más fluido)
                val steps = 10
                val stepDelay = 10000L // 1 segundo por paso → 10 seg por tramo total

                for (i in 0..steps) {
                    val t = i / steps.toFloat()
                    val lat = start.latitude + (end.latitude - start.latitude) * t
                    val lng = start.longitude + (end.longitude - start.longitude) * t

                    val current = _busPositions.value.toMutableMap()
                    current[routeName] = LatLng(lat, lng)
                    _busPositions.value = current

                    delay(stepDelay)
                }

                idx = (idx + 1) % points.size
            }
        }
    }


    fun getRoute(routeId: String?): List<LatLng>? = routes[routeId]
    // Devuelve la información del bus
    fun getBusInfo(routeId: String): BusInfo? = busInfoMap[routeId]



}



